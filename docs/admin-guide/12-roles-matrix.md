# Матрица прав доступа по уровням

## Сводная таблица: Уровни и системные роли

| Уровень | Название | Системная роль | Может управлять уровнями | Может назначать роли уровней |
|---------|----------|----------------|--------------------------|------------------------------|
| **0** | System Owner | `superadmin` | 0, 1, 2, 3, 4 (ВСЕ) | 0, 1, 2, 3, 4 (ВСЕ) |
| **1** | Executive | - (кастомные) | 2, 3, 4 | 2, 3, 4 |
| **2** | Administrator | `admin` | 3, 4 | 3, 4 |
| **3** | Staff | - (кастомные) | 4 | 4 |
| **4** | Student | `student` | - | - |

## Полная матрица прав по уровням

### Легенда
- ✅ — Право доступно по умолчанию для системной роли
- 🔧 — Право может быть назначено при создании кастомной роли
- ❌ — Право недоступно

### Студенты (students.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `students.read` | ✅ | 🔧 | ✅ | 🔧 | ❌ |
| `students.manage` | ✅ | 🔧 | ✅ | 🔧 | ❌ |
| `students.delete` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `students.reset` | ✅ | 🔧 | ✅ | 🔧 | ❌ |
| `students.progress` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Курсы (courses.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `courses.read` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `courses.manage` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `courses.delete` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Документация (docs.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `docs.read` | ✅ | 🔧 | ✅ | 🔧 | ❌ |
| `docs.edit` | ✅ | 🔧 | ✅ | 🔧 | ❌ |
| `docs.publish` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `docs.archive` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `docs.structure` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Экзамены (exams.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `exams.review` | ✅ | 🔧 | ✅ | 🔧 | ❌ |
| `exams.override` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Каталог (catalog.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `catalog.groups` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `catalog.tags.course` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `catalog.tags.user` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Персонал (staff.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `staff.manage` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Роли (roles.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `roles.manage` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `roles.assign` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

### Система (system.*)

| Право | L0 (superadmin) | L1 (custom) | L2 (admin) | L3 (custom) | L4 (student) |
|-------|:---------------:|:-----------:|:----------:|:-----------:|:------------:|
| `logins.view` | ✅ | 🔧 | ❌ | 🔧 | ❌ |
| `system.settings` | ✅ | 🔧 | ❌ | 🔧 | ❌ |

## Правила иерархии управления

### Кто кем может управлять

```
┌─────────────┐
│ Level 0     │ ← Может управлять ВСЕМИ (включая другими L0)
│ superadmin  │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ Level 1     │ ← Может управлять L2, L3, L4
│ (custom)    │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ Level 2     │ ← Может управлять L3, L4
│ admin       │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ Level 3     │ ← Может управлять только L4
│ (custom)    │
└─────┬───────┘
      │
      ▼
┌─────────────┐
│ Level 4     │ ← Не может управлять никем
│ student     │
└─────────────┘
```

### Кто какие роли может назначать

**Level 0 (superadmin):**
- ✅ Может назначить: L0, L1, L2, L3, L4 (любые роли)

**Level 1 (custom):**
- ✅ Может назначить: L2, L3, L4
- ❌ Не может назначить: L0, L1

**Level 2 (admin):**
- ✅ Может назначить: L3, L4
- ❌ Не может назначить: L0, L1, L2

**Level 3 (custom):**
- ✅ Может назначить: L4
- ❌ Не может назначить: L0, L1, L2, L3

**Level 4 (student):**
- ❌ Не может назначать никакие роли

## Примеры кастомных ролей с правами

### Уровень 1: Director (Директор)

**Права:**
```
students.read, students.manage, students.delete, students.reset, students.progress
courses.read, courses.manage
docs.read, docs.edit, docs.publish, docs.structure
exams.review, exams.override
catalog.groups, catalog.tags.course, catalog.tags.user
```

**Может управлять:**
- Пользователями уровней 2, 3, 4
- Может назначать роли уровней 2, 3, 4

### Уровень 2: Course Manager (Менеджер курсов)

**Права:**
```
students.read
courses.read, courses.manage, courses.delete
docs.read
catalog.groups, catalog.tags.course
```

**Может управлять:**
- Пользователями уровней 3, 4
- Может назначать роли уровней 3, 4

### Уровень 2: Content Editor (Редактор контента)

**Права:**
```
courses.read
docs.read, docs.edit, docs.publish, docs.archive, docs.structure
```

**Может управлять:**
- Пользователями уровней 3, 4
- Может назначать роли уровней 3, 4

### Уровень 3: Tutor (Преподаватель)

**Права:**
```
students.read, students.manage
exams.review
docs.read
```

**Может управлять:**
- Только студентами (уровень 4)
- Может назначать только роль `student`

### Уровень 3: Support (Техподдержка)

**Права:**
```
students.read, students.reset
docs.read
```

**Может управлять:**
- Только студентами (уровень 4)
- Может назначать только роль `student`

## Матрица возможностей по уровням

| Возможность | L0 | L1 | L2 | L3 | L4 |
|-------------|:--:|:--:|:--:|:--:|:--:|
| **Управление ролями** |
| Создание кастомных ролей (L1-L3) | ✅ | ❌ | ❌ | ❌ | ❌ |
| Удаление кастомных ролей | ✅ | ❌ | ❌ | ❌ | ❌ |
| Изменение прав ролей | ✅ | ❌ | ❌ | ❌ | ❌ |
| Назначение роли другому пользователю | ✅ | 🔧* | 🔧* | 🔧* | ❌ |
| **Управление пользователями** |
| Создание пользователей | ✅ | 🔧* | 🔧* | 🔧* | ❌ |
| Редактирование пользователей | ✅ | 🔧* | 🔧* | 🔧* | ❌ |
| Удаление пользователей | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Сброс прогресса студентов | ✅ | 🔧* | ✅ | 🔧* | ❌ |
| Просмотр прогресса студентов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| **Управление курсами** |
| Создание/редактирование курсов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Удаление курсов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Просмотр курсов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| **Управление документацией** |
| Чтение документации | ✅ | 🔧* | ✅ | 🔧* | ❌ |
| Редактирование документации | ✅ | 🔧* | ✅ | 🔧* | ❌ |
| Публикация документации | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Архивация документации | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Управление структурой | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| **Экзамены** |
| Проверка экзаменов | ✅ | 🔧* | ✅ | 🔧* | ❌ |
| Переопределение результатов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| **Каталог** |
| Управление группами курсов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Управление тегами курсов | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Управление тегами пользователей | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| **Система** |
| Просмотр логов входа | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Системные настройки | ✅ | 🔧* | ❌ | 🔧* | ❌ |
| Просмотр журнала аудита | ✅ | 🔧* | ❌ | 🔧* | ❌ |

**Обозначения:**
- ✅ — Доступно по умолчанию для системной роли
- 🔧* — Может быть включено при создании кастомной роли (если есть соответствующее право)
- ❌ — Недоступно

## Ограничения по иерархии

### Что НЕЛЬЗЯ сделать на каждом уровне

**Level 0 (superadmin):**
- ❌ Изменить свою собственную роль
- ❌ Понизить последнего superadmin в системе

**Level 1 (custom):**
- ❌ Управлять пользователями L0, L1
- ❌ Назначать роли L0, L1
- ❌ Создавать/удалять роли (требуется `roles.manage`)
- ❌ Изменить свою собственную роль

**Level 2 (admin):**
- ❌ Управлять пользователями L0, L1, L2
- ❌ Назначать роли L0, L1, L2
- ❌ Создавать/удалять роли
- ❌ Управлять курсами (нет `courses.*` по умолчанию)
- ❌ Публиковать документацию (нет `docs.publish`)
- ❌ Изменить свою собственную роль

**Level 3 (custom):**
- ❌ Управлять пользователями L0, L1, L2, L3
- ❌ Назначать роли L0, L1, L2, L3
- ❌ Создавать/удалять роли (требуется `roles.manage`)
- ❌ Изменить свою собственную роль

**Level 4 (student):**
- ❌ Все административные функции
- ❌ Доступна только учебная платформа

## Рекомендации по назначению уровней

### Когда использовать уровень 1 (Executive)

**Для кого:**
- Директор учебного центра
- Главный методист
- Руководитель направления

**Характеристики:**
- Широкие права на все модули
- Может управлять администраторами (L2) и персоналом (L3)
- Контроль качества и стратегическое управление

### Когда использовать уровень 2 (Administrator)

**Для кого:**
- Менеджеры направлений
- Редакторы контента
- Методисты

**Характеристики:**
- Фокус на конкретных модулях (курсы ИЛИ документация)
- Управление персоналом низшего звена (L3)
- Оперативное управление

### Когда использовать уровень 3 (Staff)

**Для кого:**
- Преподаватели
- Модераторы
- Техподдержка

**Характеристики:**
- Узкая специализация (проверка экзаменов, помощь студентам)
- Управление только студентами (L4)
- Исполнительские функции

## Вопросы и ответы

### Можно ли создать роль уровня 1 с минимальными правами?

✅ **Да.** Уровень определяет только позицию в иерархии управления, не набор прав.

Можно создать L1 роль с правами `students.read`, `docs.read` - она будет иметь высокий уровень в иерархии, но минимальные функциональные права.

### Можно ли создать роль уровня 3 с правами на управление курсами?

✅ **Да.** Можно дать L3 роли права `courses.*`.

**Но:** Эта роль не сможет управлять пользователями L0-3, только студентами (L4).

### Как понять, какой уровень назначить новой роли?

**Задайте вопросы:**
1. Кем должен управлять этот пользователь?
   - Только студентами → L3
   - Студентами и персоналом (L3) → L2
   - Всеми, кроме superadmin → L1
   - Всеми → L0 (только системная роль)

2. Какие роли должен назначать?
   - Только student → L3
   - student и кастомные L3 → L2
   - любые кроме L0 → L1

3. Нужны ли права на создание ролей?
   - Да → Только L0 (superadmin)

### У admin (L2) и кастомной роли L2 одинаковые возможности управления?

✅ **Да.** Обе могут:
- Управлять пользователями L3, L4
- Назначать роли L3, L4

❌ **Но права могут отличаться:**
- `admin` имеет фиксированный набор прав
- Кастомная L2 роль может иметь любые права (включая `courses.*`, которых нет у admin)

---

[← Предыдущая: Роли и права](11-roles-and-permissions.md) | [Назад к содержанию](README.md) | [Следующая: Лучшие практики →](16-best-practices.md)
