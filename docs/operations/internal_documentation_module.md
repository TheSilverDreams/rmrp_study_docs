# Внутренний портал документации

Этот раздел описывает базовые возможности раздела **Документация**, доступного в админской панели платформы.

## Назначение

- Создание и поддержка внутренних регламентов, инструкций и чек-листов.
- Хранение истории изменений с комментариями авторов.
- Управление статусами материалов (`Черновик`, `Актуален`, `Архив`).
- Загрузка вложений (изображения и документы) и хранение их вместе с карточкой.

## Доступы и роли

| Разрешение         | Роль по умолчанию | Описание                                                                      |
| ------------------ | ----------------- | ----------------------------------------------------------------------------- |
| `docs.read`        | admin, superadmin | Просмотр списка и содержимого документов.                                     |
| `docs.edit`        | admin, superadmin | Создание и редактирование документов, загрузка и удаление вложений.           |
| `docs.publish`     | superadmin        | Перевод документов в статус «Актуален» и возвращение из архива.               |
| `docs.archive`     | superadmin        | Перевод документов в архив.                                                   |
| `docs.manage`      | superadmin        | Резерв на будущие настройки (создание категорий и пр.); пока не используется. |

> Черновики видны только пользователям с правом `docs.edit`. Для супер-админов дополнительно выводится информация о создателе и последнем редакторе.

## Структура и статусы

- **Аудитории:** по умолчанию две группы — «Общая документация» и «Доступы и учётные записи».
- **Категории:** задаются в базе, могут расширяться через будущий интерфейс.
- **Статусы:**
  - `draft` — черновик, доступен только редакторам;
  - `published` — опубликованная версия;
  - `archived` — материал в архиве (не выводится в списке по умолчанию).

Разрешённые переходы:

```
draft → published (публикация)
published → draft (возврат в черновик)
published → archived (архивация)
archived → published (возврат в актуальные)
archived → draft (подготовка новой версии)
```

## Работа в интерфейсе

1. Откройте раздел «Документация» в верхней навигации.
2. Выберите аудиторию и категорию, воспользуйтесь поиском или фильтром по статусу.
3. Для создания документа нажмите «Новый документ» и заполните форму (поддерживается Markdown).
4. Для редактирования существующего документа используйте кнопку «Редактировать», укажите комментарий к изменению.
5. Вложения можно загружать, нажимая «Загрузить файл» (поддерживаются изображения и распространённые форматы документов).
6. История версий хранит комментарии и автора каждой правки.

## API (основные конечные точки)

Все маршруты доступны по префиксу `/api/admin/docs` и требуют авторизации.

- `GET /categories` — список категорий.
- `GET /` — список документов с фильтрами (`audience`, `categoryId`, `status`, поиск).
- `POST /` — создание документа.
- `GET /:documentId` — подробности по документу (содержание, история, вложения).
- `PUT /:documentId` — обновление документа + новая версия контента.
- `PATCH /:documentId/status` — смена статуса.
- `POST /:documentId/attachments` — загрузка вложения (multipart/form-data).
- `GET /:documentId/attachments/:attachmentId` — скачивание вложения.
- `DELETE /:documentId/attachments/:attachmentId` — удаление вложения.

## Ограничения и дальнейшие задачи

- Импорт из Google Docs и других источников перенесён на следующий этап.
- Нет визуального сравнения версий (`diff`), пока отображается только список изменений.
- Категории сейчас управляются через базу; требуется интерфейс для редактирования.
- Предусмотреть теги или быстрые ссылки на документы из других разделов.
- Подумать про разграничение доступа к отдельным категориям (например, только для суперадминов).

## Подготовка окружения

1. Выполните миграции (`npm run migrate` в `backend`), чтобы создать таблицы и категории.
2. Убедитесь, что у нужных пользователей назначены разрешения (`docs.*`).
3. Для хранения файлов используется директория `backend/data/uploads/documents` (создаётся автоматически). При необходимости синхронизируйте её при деплое.
