# Архитектура платформы RMRP

## Общий обзор
Платформа состоит из двух приложений, работающих в режиме монорепозитория npm workspaces: TypeScript/Express API (`backend/`) и клиентского интерфейса на React + Vite (`frontend/`). Компоненты взаимодействуют через JSON API по адресу `/api`. В качестве базы данных используется SQLite (через `better-sqlite3`), файл хранится в каталоге `backend/data` и создаётся автоматически при запуске.

## Бэкенд
- **Фреймворк:** Express 5 с TypeScript, запуск описан в `src/server.ts`.
- **Конфигурация:** `src/config/env.ts` читает переменные окружения, создаёт директорию `data/` и формирует настройки (порт, путь к БД, параметры JWT и bcrypt).
- **База данных:** миграции и сиды реализованы через скрипты `src/db/migrate.ts` и `src/db/seed.ts`. Структура покрывает пользователей, курсы, модули (текстовые и квиз), вопросы, попытки прохождения.
- **Аутентификация:** JWT (`src/auth/jwt.ts`), хэширование паролей (`src/auth/password.ts`). Middleware `src/middleware/auth.ts` проверяет токен и роли.
- **Доменная логика:** вынесена в `src/domain/*`. Модули `courses.ts`, `quizzes.ts`, `users.ts`, `courseManagement.ts` обеспечивают бизнес-правила для студентов, администраторов и суперадминов.
- **Маршруты:** `src/routes` группирует API по зонам ответственности (`auth`, `courses`, `admin`, `superadmin`). Общий роутер собирается в `src/routes/index.ts`.

## Фронтенд
- **Стек:** React 18, Vite, TypeScript, TailwindCSS.
- **Состояние и запросы:** контекст авторизации (`src/context/AuthContext.tsx`), React Query (`src/lib/queryClient.ts`) для кеширования запросов, axios-обёртка (`src/lib/api.ts`).
- **Маршрутизация:** React Router (`src/App.tsx`) с публичными (`PublicRoute`) и защищёнными маршрутами (`ProtectedRoute`), поддержкой ролевой навигации.
- **Интерфейс:** страницы разбиты по сценариям — дашборд студента, кабинет администратора (пользователи и прогресс), инструменты суперадмина для управления курсами и банком вопросов.

## Основные сценарии
1. **Студент:** изучает теорию, запускает и сдаёт квизы, формируется история попыток.
2. **Администратор:** управляет студентами, сбрасывает пароли, отслеживает прогресс по курсам.
3. **Суперадмин:** создаёт и редактирует курсы, модули и вопросы, настраивает параметры квизов.

## Безопасность и инфраструктура
- Авторизация по JWT-токену (хранится в localStorage на фронтенде).
- Проверка ролей на бэкенде и фронтенде.
- Использование `helmet` и `cors` в Express для базовой защиты HTTP.

## Локальная разработка
- `npm run dev` в корне запускает бэкенд (`localhost:4000`) и фронтенд (`localhost:5173`).
- `npm run seed` подготавливает БД демо-данными с тремя аккаунтами (superadmin, admin, student).
- SQLite-файл `backend/data/rmrp.sqlite` можно открыть любым браузером SQLite для диагностики.

## Текущее состояние автоматики
Автотесты и CI/CD пока не настроены. Миграции и сиды выполняются вручную, контроль качества осуществляется через ручное тестирование.

## Обновления (осень 2025)
- Добавлена страница "Администраторы" в панели суперадмина: создание, редактирование, назначение прав и удаление сотрудников c ролями admin/superadmin.
- Реализован сброс пароля администраторами через /superadmin/administrators/:id/reset-password с показом новых учётных данных в интерфейсе.
- Улучшена авторизация: при истечении JWT токена клиент удаляет сессию, перенаправляет на страницу входа и отображает предупреждение о необходимости повторного входа.
