# Этап E — Корпоративный портал и аналитика

**Цель:** расширить систему до полноценного корпоративного портала администрации, объединяющего персональные карточки сотрудников, операционную статистику и инструменты руководителей.

## Область работ
- Создание карточек администраторов с детализированной информацией, историей и KPI.
- Подключение источников данных (игровые серверы, отчётность, CRM) и построение аналитических витрин.
- Разработка дашбордов и отчётов для контроля эффективности, рабочего времени, выполненных задач.

## Ключевые результаты
- Модель данных для профилей сотрудников (`admin_profiles`, `admin_assignments`, `admin_skill_matrix`).
- Система сбора и хранения метрик (`admin_metrics`, `metric_definitions`, `metric_snapshots`).
- Карточка администратора: персональные данные, доступы, история назначений, KPI, документы, заметки руководителя.
- Дашборды: оперативный мониторинг (репорты, онлайн, закрытие задач), аналитика по серверам/командам.
- Процесс обновления данных: расписание, валидаторы, журналы импорта, алёрты при сбоях.
- Политики приватности и разграничение доступа к персональным данным.

## Workstreams
### Данные и интеграции
- Определение источников: API серверов, выгрузки CSV, ручной ввод. Формат обмена (JSON/CSV), периодичность.
- ETL-пайплайн: адаптеры для источников, нормализация данных, дедупликация, обработка ошибок (reties, dead-letter).
- Версионирование метрик и хранение истории (помесячные/понедельные срезы).
- Хранилище файлов (отчёты, договоры, сертификаты) с правами доступа.

### Backend
- Модели и миграции для профилей, назначений, показателей, вложений.
- API:
  - `/superadmin/profiles` — CRUD профилей, загрузка/обновление данных.
  - `/superadmin/metrics` — управление метриками, диапазоны, единицы измерения.
  - `/superadmin/reports` — агрегации и фильтры (по периоду, серверу, типу метрики).
- Расчёт агрегатов: среднее время реакции, закрытые тикеты, активность в сменах.
- Механизм ручных корректировок с audit-трассой (кто внёс изменение, почему).

### Frontend
- **Карточка администратора**
  - Базовый блок: фото/аватар, контакты, статусы (активен/в отпуске), назначенные роли и разрешения.
  - Таймлайн: ключевые события (назначения, обучение, награды, предупреждения).
  - Метрики: графики (line/bar), таблицы по последним периодам, цели, комментарии руководителя.
  - Документы и ссылки (регламенты, допуски, сертификаты).
- **Дашборды**
  - Обзор по серверам/командам: активность, закрытые репорты, среднее время ответа.
  - Лидеры и зоны риска: кто перегружен, у кого проседают показатели.
  - Фильтры по периоду, серверу, типу метрики, роли.
- **Редактор данных**
  - Импорт CSV/Excel, фиксация ошибок, подсказки по формату.
  - Форма ручного ввода/коррекции с обязательным комментарием.

### Политики и комплаенс
- Разграничение доступа: кто видит персональные данные, какие поля доступны обычному админу vs руководителю.
- Анонимизация/псевдонимизация для агрегированных отчётов.
- Согласование с юридическим отделом требований по хранению персональных данных (сроки, права субъекта).

### Инфраструктура
- Возможно вынесение аналитических данных в отдельное хранилище (PostgreSQL, ClickHouse).
- Настройка задач по расписанию (cron, Airflow, Temporal) и мониторинг ETL.
- Резервное копирование и возможность восстановления исторических данных.

### Документация и обучение
- Руководство руководителя: как интерпретировать метрики, как работать с карточками.
- Инструкции по импорту/экспорту данных, описание форматов.
- План коммуникации при запуске (анонс, обучение, каналы обратной связи).

## Зависимости
- Реализованные этапы A–D (стабильная база данных, RBAC, безопасность).
- Доступ к внешним источникам данных и согласованные SLA на поставку.
- Определённые KPI/OKR от руководства компании.

## Риски и меры
- **Неполные/некорректные данные.** → Валидация на входе, отчёты о качестве данных, возможность ручной коррекции.
- **Конфиденциальность.** → Шифрование чувствительных полей, строгий контроль доступа, аудит чтения.
- **Избыточная сложность.** → Итеративное внедрение: пилот на одной команде/сервере, сбор обратной связи, масштабирование.

## Метрики успеха
- 100 % админов имеют карточку с базовыми данными и минимум 3 KPI.
- Не менее 2 управленческих отчётов используются еженедельно (отчёт о потреблении данных).
- Снижение времени на подготовку ручных отчётов ≥50 %.

## Таймлайн (оценка)
- **Месяц 1:** проектирование данных и интеграций, пилотные ETL, базовая карточка администратора.
- **Месяц 2:** расширенные метрики, дашборды, контроль доступа, обучение пилотной команды.
- **Месяц 3:** масштабирование, оптимизация, ретроспектива и план дальнейших улучшений.
